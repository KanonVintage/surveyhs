<template>
  <div class="login">
    <v-snackbar
      v-model="snackbar"
      :timeout="2000"
      :top=true
      color= 'red'
    >
      Usuario o Contraseña Incorrectos.
    </v-snackbar>
  <v-container align-center>
    
    <v-layout row wrap>
      <v-flex xs4></v-flex>
      <v-flex xs4>
        <v-img src="http://www.espol.edu.ec/sites/default/files/espol%20simbolo.png" max-width="500" aspect-ration=0.5></v-img>
       </br>
       </br>
      <v-form v-model="valid">
        <v-text-field 
          v-model="name"
          :rules="nameRules"
          :counter="10"
          label="Nombre de usuario"
          required
          v-on:keyup.enter="realizarLogin()"
        ></v-text-field>
        <v-text-field
        v-model='password'
          :append-icon="show1 ? 'visibility_off' : 'visibility'"
          :rules="passwordRules"
          label="Contraseña"
          :type="show1 ? 'text' : 'password'"
          name="input-10-1"
          hint="Necesita mínimo 8 caracteres"
          counter
          @click:append="show1 = !show1"
          v-on:keyup.enter="realizarLogin()"
          ></v-text-field>
        <v-btn v-on:click="realizarLogin()">Iniciar Sesión</v-btn>
      </v-form>
    </v-flex>
  </v-layout>
  </v-container>

  </div>
</template>

<script>
import LoginService from '@/services/LoginService'
export default {
  data: () => ({
    valid: false,
    name: "",
    show1: false,
    nameRules: [
      v => !!v || "Nombre de usuario requerido",
      v => v.length <= 10 || "Nombre de usuario no debe tener mas de 10 caracteres"
    ],
    email: "",
    passwordRules: [
      v => !!v || "Contraseña requerida",
      v => v.length >= 8 || "Minimo 8 caracteres"
    ],
    password: '',
    snackbar: false,
  }),
  name: 'login',
  methods: {
    async realizarLogin() {
      try{
        let response = await LoginService.realizarLogin({
            user: this.name,
            password: this.password
        });

        if (response.status == 200 && response.data.datos.matched){
          this.$session.start();
          this.$session.set('jwt', response.data.datos);
          this.$http.headers.common['Authorization'] = 'Bearer ' + response.data.datos.experto
          this.$router.push('/survey/'+response.data.datos.experto+'/Nnkx0sT_G')
        } else{
          this.snackbar= true;
        }
      } catch(err){
        if (err.response.status== 404){
          this.snackbar= true;
        }
      }
      
    }
  }
};
</script>